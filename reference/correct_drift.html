<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Correct drift using cubic spline — correct_drift • notame</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correct drift using cubic spline — correct_drift"><meta name="description" content="A wrapper function for applying cubic spline drift correction and saving
before and after plots."><meta property="og:description" content="A wrapper function for applying cubic spline drift correction and saving
before and after plots."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">notame</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">General introduction</a></li>
    <li><a class="dropdown-item" href="../articles/project_example.html">Project example</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hanhineva-lab/notame/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Correct drift using cubic spline</h1>
      <small class="dont-index">Source: <a href="https://github.com/hanhineva-lab/notame/blob/main/R/drift_correction.R" class="external-link"><code>R/drift_correction.R</code></a></small>
      <div class="d-none name"><code>correct_drift.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A wrapper function for applying cubic spline drift correction and saving
before and after plots.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">correct_drift</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  log_transform <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spar_lower <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  spar_upper <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  check_quality <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  condition <span class="op">=</span> <span class="st">"RSD_r &lt; 0 &amp; D_ratio_r &lt; 0"</span>,</span>
<span>  plotting <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  color <span class="op">=</span> <span class="st">"QC"</span>,</span>
<span>  shape <span class="op">=</span> <span class="va">color</span>,</span>
<span>  color_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"notame.color_scale_dis"</span><span class="op">)</span>,</span>
<span>  shape_scale <span class="op">=</span> <span class="fu">scale_shape_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  assay.type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a <code>
<a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></code>
or <code><a href="MetaboSet-class.html">MetaboSet</a></code> object</p></dd>


<dt id="arg-log-transform">log_transform<a class="anchor" aria-label="anchor" href="#arg-log-transform"></a></dt>
<dd><p>logical, should drift correction be done on
log-transformed values? See Details</p></dd>


<dt id="arg-spar">spar<a class="anchor" aria-label="anchor" href="#arg-spar"></a></dt>
<dd><p>smoothing parameter as in
<code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></code></p></dd>


<dt id="arg-spar-lower-spar-upper">spar_lower, spar_upper<a class="anchor" aria-label="anchor" href="#arg-spar-lower-spar-upper"></a></dt>
<dd><p>lower and upper limits for the smoothing
parameter</p></dd>


<dt id="arg-check-quality">check_quality<a class="anchor" aria-label="anchor" href="#arg-check-quality"></a></dt>
<dd><p>logical, whether quality should be monitored.</p></dd>


<dt id="arg-condition">condition<a class="anchor" aria-label="anchor" href="#arg-condition"></a></dt>
<dd><p>a character specifying the condition used to decide whether
drift correction
works adequately, see Details</p></dd>


<dt id="arg-plotting">plotting<a class="anchor" aria-label="anchor" href="#arg-plotting"></a></dt>
<dd><p>logical, whether plots should be drawn</p></dd>


<dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>path to the PDF file where the plots should be saved</p></dd>


<dt id="arg-width-height">width, height<a class="anchor" aria-label="anchor" href="#arg-width-height"></a></dt>
<dd><p>width and height of the plots in inches</p></dd>


<dt id="arg-color">color<a class="anchor" aria-label="anchor" href="#arg-color"></a></dt>
<dd><p>character, name of the column used for coloring the points</p></dd>


<dt id="arg-shape">shape<a class="anchor" aria-label="anchor" href="#arg-shape"></a></dt>
<dd><p>character, name of the column used for shape</p></dd>


<dt id="arg-color-scale-shape-scale">color_scale, shape_scale<a class="anchor" aria-label="anchor" href="#arg-color-scale-shape-scale"></a></dt>
<dd><p>the color and shape scales as returned by a
ggplot function</p></dd>


<dt id="arg-assay-type">assay.type<a class="anchor" aria-label="anchor" href="#arg-assay-type"></a></dt>
<dd><p>character, assay to be used in case of multiple assays</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>character, name of the resultant assay in case of multiple assays</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A SummarizedExperiment or MetaboSet object as the one supplied, with
drift corrected features.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>log_transform = TRUE</code>, the correction will be done on
log-transformed values.
The correction formula depends on whether the correction is run on original
values or log-transformed values.
In log-space: \(corrected = original + mean of QCs - prediction by cubic
spline\).
In original space: \(corrected = original * prediction for first QC /
prediction for current point\).
We recommend doing the correction in the log-space since the log-transfomred
data better follows the assumptions of cubic spline regression. The drift
correction in the original space also sometimes results
in negative values, and results in rejection of the drift corrrection
procedure.
If <code>spar</code> is set to <code>NULL</code> (the default), the smoothing parameter
will be separately chosen for each feature from the range
[<code>spar_lower, spar_upper</code>] using cross validation.
If  <code>check_quality = TRUE</code>, the <code>condition</code> parameter should be a
character giving a condition compatible with <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></code>.
The condition is applied on the <strong>changes</strong> in the quality metrics
RSD, RSD_r, D_ratio and D_ratio_r. For example, the default is "RSD_r &lt; 0
and D_ratio_r &lt; 0", meaning that both RSD_r and D_ratio_r need to decrease
in the drift correction, otherwise the drift corrected feature is discarded
and the original is retained.
By default, the column used for color is also used for shape.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></code> for details about the regression</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_set</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">correct_drift</span><span class="op">(</span><span class="va">example_set</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:30] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Starting drift correction at 2025-06-23 22:36:30.643302</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:30] Zero values in feature abundances detected. Zeroes will be replaced with 1.1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:31] Drift correction performed at 2025-06-23 22:36:31.005327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:31] Inspecting drift correction results 2025-06-23 22:36:31.173394</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:31] Drift correction results inspected at 2025-06-23 22:36:31.449137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INFO [2025-06-23 22:36:31] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Drift correction results inspected, report:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Drift_corrected: 100%</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anton Klåvus, Jussi Paananen, Oskari Timonen, Atte Lihtamo, Vilhelm Suksi, Retu Haikonen, Leo Lahti, Kati Hanhineva.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

